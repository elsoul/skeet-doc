---
id: general-about-v3
title: Ver.3 について (Soon)
description: Skeet Ver.3 について (Soon)
---

Skeet Ver.2 へのアップデートでは主に下記の改善を行いました。

- pnpm の導入: モノリポや複数プロジェクトにおいて、より効率的なパッケージ管理を実現しました。ディスクスペースを節約し、高速なパッケージのインストールを実現します。GitHub Actions においてもキャッシュを有効活用し、ビルド時間を大幅に短縮しました。
- vitest の導入: テストパッケージを vitest に更新しました。このより高性能なテストランナーは、変更を検知するたびにテストを実行するデーモン起動も可能で、開発効率をさらに向上させます。
- Changesets の導入: これまで Skeet の各種モジュールは別々のリポジトリにて管理されていましたが、モノリポでの管理へ移行。パッケージのリリースには Changesets を導入いたしました。Changesets は各パッケージの変更を自動検知し、バージョンを変更、Changelog の作成、リリースノートの作成など様々な自動化が行われました。
- SQL テンプレート (Hono Web サーバー) Scaffold の導入: Prisma で作成(記述)したモデルファイルから、自動的に Hono Web サーバーを利用してルーティングし、CRUD API を生み出します。それらはすぐにデプロイ可能な状態になっています。これにより、リレーショナルデータベース(SQL)の設計から API サーバー公開までの時間を大幅に短縮しました。
- Firebase 呼び出し可能関数に対応: Firebase Functions の呼び出し可能関数を利用することで、https エンドポイントを公開することなく、自分たちの Firebase アプリからのみ呼び出せる関数を作成することができます。これにより、セキュリティを向上させることができます。

# Skeet Ver.3 について

Skeet Ver.3 では、さらなる開発効率の向上を目指し、下記の改善を行います。

## 各テンプレートのモノリポ移行とより最適なモジュール化

Skeet の公開 NPM モジュールはモノリポへの移行を完了しましたが、まだ Skeet 初期アプリのテンプレート(Skeet Next.js + Firestore や Expo + Firestore)は独立したリポジトリで管理が行われています。これらのテンプレートもモノリポへの移行を行い、より効率的なモジュール化を実現し、開発効率と品質を向上させます。

現在テンプレートは下記のように大きくフロントエンドの形態に依存していますが、これをモジュール化することで、より柔軟なテンプレートのカスタマイズが可能になります。

```
├── src
│   ├── Frontend codes
├── functions
│   ├── functionsA
│   └── functionsB
├── sql
│   ├── sqlA
│   └── sqlB
├── common
│   ├── enums
│   ├── lib
│   ├── models
│   └── types
├── package.json
├── skeet-cloud.config.json
└── firebase.json
...
```

新しい Skeet アプリのモノリポ構成は、以下のようになる予定です。

```
├── webapp
│   ├── webappA
│   └── webappB
├── website
│   ├── websiteA
│   └── websiteB
├── mobile
│   ├── mobileA
│   └── mobileB
├── functions
│   ├── functionsA
│   └── functionsB
├── sql
│   ├── sqlA
│   └── sqlB
├── common
│   ├── enums
│   ├── lib
│   ├── models
│   └── types
├── package.json
├── skeet-cloud.config.json
└── firebase.json
...
```

これにより、単純なスケジューラー関数だけのプロジェクトから、Web アプリ、ドキュメントサイト、そしてモバイルアプリ等をもつ大規模なプロジェクトまで、Skeet は柔軟に構築できるようになります。

Web アプリテンプレート(webapp)は Next.js を用いて SSR 対応の管理画面等 Web サービス用テンプレートや、Solana ブロックチェーンを用いた Web3 アプリを開発可能なテンプレートなど、多様なテンプレートを提供する予定です。

ドキュメント Web サイト用の SSG(静的サイト生成)のテンプレート(website)も提供し、低コストで高速動作するドキュメントサイトやコーポレートウェブサイトを簡単に構築できるようになります。

mobile に関しても Expo を使い、Web2 用の iOS/Android アプリ開発テンプレート、そして Solana Mobile Stack に対応した Web3 テンプレートを提供予定です。

## .env ファイル群の共有機能

Firebase Functions の Secret は自動で共有されますが、SQL Web API テンプレートを取り扱う際は.env 系のファイル群を共有する必要がありました。(gitignore されているため、git を介して共有されません。)Skeet Ver.3 では、これらの.env ファイル群をもし手元になければ、自動で共有する機能を追加します。この機能は Google Cloud の IAM 及び GitHub のアカウント権限を利用して実現され、セキュアな共有が可能です。

## フロントエンドツールの強化

Skeet Ver.3 では、以下のツールを導入して、フロントエンド開発の効率をさらに向上させます。

### Next.js App Router の導入

Next.js の App Router が登場(2022 年 10 月)してから約 1 年半が経過し、ドキュメントの充実や周辺技術の対応など、だいぶ環境も整ってまいりました。満を持して Skeet にもこの App Router を導入いたします。

以前の Pages ベースのルーティングが進化し、ファイル名によって役割を分担させることで、よりコード量を減らすことができます。例えば、エラーハンドリング用の ErrorBoundary や Suspense など、定型のコードを書かずとも、error.tsx というファイルがあれば、それがエラーハンドリング用のコンポーネントとして認識され、自動で表示を切り替わるようになります。今まではこれのためにコードのネストが深くなって(コード量が増えて見通しが悪くなる)しまっていたのですが、そういったコードが減ることで、開発効率が向上します。

以前の形式だと必要なコンポーネントが色々なフォルダに散らばってしまっていましたが、コンポーネント依存のファイルは近くにまとめておくこともできるようになるため、コードの保守性や開発効率が向上します。

https://nextjs.org/docs/app/building-your-application/routing/defining-routes

### SSR テンプレート及び SSG テンプレートの両対応

Skeet Ver.3 では、SSR(サーバーサイドレンダリング)対応のテンプレートと、SSG(静的サイト生成)+CSR(クライアントサイドレンダリング) 対応のテンプレートの両方を提供します。これにより、より柔軟な Web アプリケーションの開発が可能になります。

フロントエンドの役割はどんどん増えているため、SSR によるパフォーマンス改善が必須になりつつあります。

簡単になぜ SSR でパフォーマンスが改善するのかを下記に説明します。

**CSR（クライアントサイドレンダリング）のプロセス**

1. ブラウザが HTML をリクエストしますが、この時点ではデータは含まれていません。
2. ブラウザが JavaScript をダウンロードし、実行します。これには時間がかかります。
3. JavaScript がデータをフェッチするために再度サーバーや API にリクエストします。この段階で初めてデータがブラウザに送られます。
4. ブラウザが受け取ったデータをもとにページをレンダリングします。

このプロセスでは、データをフェッチするために追加の時間がかかり、ユーザーがコンテンツを見るまでの時間が長くなります。

**SSR（サーバーサイドレンダリング）のプロセス**

1. サーバーがリクエストを受け取り、必要なデータをフェッチします。この時点でサーバーはデータソースに直接アクセスできるため、データフェッチは効率的です。
2. サーバーがデータをもとに HTML を生成し、レンダリングします。この HTML には既にコンテンツが含まれています。
3. 生成された HTML がブラウザに送信されます。ブラウザはこの HTML を直接表示できます。
4. SSR では、ブラウザがデータをフェッチするために追加のリクエストを行う必要がなく、ユーザーが最初のページを見るまでの時間が大幅に短縮されます。また、サーバーがデータフェッチを行うため、クライアント側のデバイス性能やネットワークの状態に左右されにくいです。

今まで SSR をするためにはリソースの管理が必要で管理コストが掛かっていましたが、Skeet Ver.3 では、サーバーレスでリソースは自動管理、Cloud Run やロードバランサーへの接続も Skeet が自動で行います。

一方で、ユーザーによって違うコンテンツを表示する必要がない場合、SSG の方が効率的です。シンプルなホスティングを利用できるので、料金がほとんどかからずに高速なページを提供できます。ドキュメントサイトやブログサイトはこちらの構成が向いています。

### 多言語対応には next-intl

App Router 導入に伴い、多言語対応の方法も変更になりますが、next-intl が使いやすそうです。セットアップは Skeet が担当するため、使い勝手は工場します。

具体的には現在の多言語対応だと、Page ルーターにて、`[locale]`フォルダ内外に 2 つのファイルを用意する必要がありますが、App Router では`(locale)`フォルダ内に単一のファイルを追加するだけで良くなります。

https://next-intl-docs.vercel.app/

### グローバルの状態管理に Jotai

現在グローバルの状態管理には Recoil を使用していますが、同じコンセプトでより軽量で高速に動作する Jotai に移行します。

現在 Recoil は開発が停止しているように見えますが、Jotai の開発は非常にアクティブです。(2024 年 2 月 28 日時点で、Recoil の最終リリースは 2023 年 4 月に v0.7.7。Jotai は 2024 年 2 月 27 日に v2.7.0 がリリースされています)

Recoil の開発元の Meta 社のロゴが Jotai に表示されているため、実質的に Recoil の後継となっているように見えます。

使い勝手は特に状態のリセット周りで良くなりそうで、簡単に移行できます。

https://jotai.org/

### クライアントサイドのデータ取得管理に SWR

データフェッチ(エラーハンドリング、読込中のハンドリング)について毎回のやり方を統一、そしてコード量を減らすために SWR を導入します。
高度なキャッシュ機能も提供されているため、データの再取得を最小限に抑えることができます。
複数のデータソースがあっても、その分のラッパーを用意することで対応可能です。

App Router と合わせて使用することで、より少ないコードでより手厚く柔軟なエラーハンドリングが可能になり、結果的にアプリケーションの品質が向上します。

https://swr.vercel.app/

### shadcn UI の導入

shadcn UI は、Tailwind CSS をベースにして拡張したオープンソースの UI コンポーネントライブラリです。

Tailwind CSS は柔軟なコンポーネントの記述が可能でとても使いやすい反面、すべてを最初から作る必要があり、その分だけプロジェクトのロケットスタートがしづらいという問題がありましたが、shadcn UI はその問題を解決し、より効率的な開発が可能になります。

コードをそのままコピーして使うことができ、コピーしてきたコードも Tailwind ベースなため、慣れ親しんだ方法で簡単にカスタマイズできます。コピーしてきたコードの変更も、コンポーネント自体に className を追加するカスタマイズも可能で、柔軟な対応ができます。

https://ui.shadcn.com/

### Expo Router に対応

Expo は React Native のフレームワークで、React Native での開発をより簡単にするためのツールです。

Web アプリを開発する感覚で、React という同じ技術を使ってモバイルアプリを開発できるため、Web アプリとモバイルアプリの開発を同時に進めることができます。

しかしこれまでは Next.js のような高性能なルーターが無く、コードの記述量が増え、レイアウトコードが散らばったり、コードの見通しが悪くなるという問題がありました。

Expo Router v3 は、Next.js の App Router と同じように使え、コードの記述量を減らし、関連コードをまとめて開発を進めることができます。

https://docs.expo.dev/router/introduction/

## 開発チーム Discord

Skeet の開発チームは常に品質向上を目指しており、Discord 上での議論に積極的です。

なにかご質問やご意見があれば、ぜひ Discord に参加してください。

https://discord.com/invite/H2HeqRq54J
